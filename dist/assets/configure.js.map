{"version":3,"sources":["../../src/assets/configure.js"],"names":["location","pathname","match","jest","console","error","options","renderSpec","storyId","story","name","kind","component","window","__STORYBOOK_CLIENT_API__","__STORYBOOK_ADDONS_CHANNEL__","Error","channel","toId","Promise","resolve","reject","on","document","getElementById","emit","_handleEvent","type","args","from","body","classList","contains","message","textContent","stack","specs","storyStore","_storyStore","specFromStory","id","parameters","chromatic","viewports","delay","disable","noScroll","diffThreshold","displayName","split","slice","extract","Object","values","map","getStorybook","stories","getStoryAndParameters","reduce","a","b"],"mappings":"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","sourcesContent":["/* eslint-env browser */\n/* eslint-disable import/no-extraneous-dependencies, global-require */\n\nimport { toId } from '@storybook/core/client';\n\nimport configure from '../client';\n\n// eslint-disable-next-line no-restricted-globals\nif (!location.pathname.match('/iframe.html') && typeof jest === 'undefined') {\n  console.error(`storybook-chromatic should be installed in your \\`.storybook/config.js\\``);\n}\n\nexport default (options = {}) =>\n  configure({\n    async renderSpec({ storyId, name: story, component: { name: kind } }) {\n      const { __STORYBOOK_CLIENT_API__, __STORYBOOK_ADDONS_CHANNEL__ } = window;\n\n      if (!__STORYBOOK_CLIENT_API__ || !__STORYBOOK_ADDONS_CHANNEL__) {\n        throw new Error(\n          `Chromatic requires Storybook version at least 3.4. Please update your storybook!`\n        );\n      }\n\n      const channel = __STORYBOOK_ADDONS_CHANNEL__;\n\n      // In storybook 5+ we can be sure of the emitting, and we need to use a storyId API\n      if (toId) {\n        return new Promise((resolve, reject) => {\n          channel.on('storyRendered', () => resolve(document.getElementById('root')));\n          channel.on('storyUnchanged', () => resolve(document.getElementById('root')));\n          channel.on('storyErrored', error => reject(error));\n          channel.on('storyThrewException', error => reject(error));\n\n          channel.emit('setCurrentStory', { storyId: storyId || toId(kind, story) });\n        });\n      }\n\n      // We need to emulate the event sent by the manager to the preview.\n      // In SB@4+ if we emit a message on the channel it will get picked up by the preview\n      // (note that we are on the preview side). However, in SB@3.4, perhaps more correctly,\n      // if we emit a message, it won't be picked up by the preview. So we need to reach\n      // in and simulate receiving an event\n      // eslint-disable-next-line no-underscore-dangle\n      channel._handleEvent({\n        type: 'setCurrentStory',\n        args: [{ kind, story }],\n        from: 'chromatic',\n      });\n\n      // If the story has rendered with an error, SB does not return any kind of error\n      // (we will fix this...) However, in the meantime, you can pick this up via a class on the body\n      if (document.body.classList.contains('sb-show-errordisplay')) {\n        const message = document.getElementById('error-message').textContent;\n        const stack = document.getElementById('error-stack').textContent;\n        const error = new Error(message);\n        error.stack = stack;\n        throw error;\n      }\n\n      return document.getElementById('root');\n    },\n    specs() {\n      const { __STORYBOOK_CLIENT_API__, __STORYBOOK_ADDONS_CHANNEL__ } = window;\n\n      if (!__STORYBOOK_CLIENT_API__ || !__STORYBOOK_ADDONS_CHANNEL__) {\n        throw new Error(\n          `Chromatic requires Storybook version at least 3.4. Please update your storybook!`\n        );\n      }\n\n      // eslint-disable-next-line no-underscore-dangle\n      const storyStore = __STORYBOOK_CLIENT_API__._storyStore;\n\n      function specFromStory({ id, kind, name, parameters: { chromatic } = {} }) {\n        let parameters;\n        if (chromatic) {\n          const { viewports, delay, disable, noScroll, diffThreshold } = chromatic;\n          parameters = {\n            ...(viewports && { viewports }),\n            ...(delay && { delay }),\n            ...(disable && { disable }),\n            ...(noScroll && { noScroll }),\n            ...(diffThreshold && { diffThreshold }),\n          };\n        }\n\n        return {\n          storyId: id,\n          name,\n          component: {\n            name: kind,\n            displayName: kind.split('/').slice(-1)[0],\n          },\n          parameters,\n        };\n      }\n\n      // Storybook 5+ API\n      if (storyStore.extract) {\n        return Object.values(storyStore.extract()).map(specFromStory);\n      }\n\n      // Storybook 4- API\n      return __STORYBOOK_CLIENT_API__\n        .getStorybook()\n        .map(({ kind, stories }) =>\n          stories.map(({ name }) =>\n            specFromStory({\n              kind,\n              name,\n              parameters:\n                storyStore.getStoryAndParameters &&\n                storyStore.getStoryAndParameters(kind, name).parameters,\n            })\n          )\n        )\n        .reduce((a, b) => [...a, ...b], []); // flatten\n    },\n    ...options,\n  });\n"],"file":"configure.js"}