{"version":3,"sources":["../../src/assets/configure.js"],"names":["location","pathname","match","jest","console","error","runtime","options","renderSpec","specRuntime","story","name","kind","component","window","__STORYBOOK_CLIENT_API__","__STORYBOOK_ADDONS_CHANNEL__","Error","channel","toId","Promise","resolve","reject","on","document","getElementById","emit","storyId","_handleEvent","type","args","from","body","classList","contains","message","textContent","stack","specs","storyStore","_storyStore","getStorybook","map","stories","parameters","getStoryAndParameters","chromatic","viewports","delay","disable","noScroll","displayName","split","slice","reduce","a","b"],"mappings":"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","sourcesContent":["/* eslint-env browser */\n/* eslint-disable import/no-extraneous-dependencies, global-require */\n\nimport { toId } from '@storybook/core/client';\n\nimport configure from '../client';\n\n// eslint-disable-next-line no-restricted-globals\nif (!location.pathname.match('/iframe.html') && typeof jest === 'undefined') {\n  console.error(`storybook-chromatic should be installed in your \\`.storybook/config.js\\``);\n}\n\nconst runtime = 'storybook';\nexport default (options = {}) =>\n  configure({\n    runtime,\n    async renderSpec({ runtime: specRuntime, name: story, component: { name: kind } }) {\n      const { __STORYBOOK_CLIENT_API__, __STORYBOOK_ADDONS_CHANNEL__ } = window;\n\n      if (!__STORYBOOK_CLIENT_API__ || !__STORYBOOK_ADDONS_CHANNEL__) {\n        throw new Error(\n          `Chromatic requires Storybook version at least 3.4. Please update your storybook!`\n        );\n      }\n\n      if (specRuntime !== runtime) {\n        throw new Error(`Storybook plugin cannot handle ${specRuntime} specs`);\n      }\n\n      const channel = __STORYBOOK_ADDONS_CHANNEL__;\n\n      // In storybook 5+ we can be sure of the emitting, and we need to use a storyId API\n      if (toId) {\n        return new Promise((resolve, reject) => {\n          channel.on('storyRendered', () => resolve(document.getElementById('root')));\n          channel.on('storyUnchanged', () => resolve(document.getElementById('root')));\n          channel.on('storyErrored', error => reject(error));\n          channel.on('storyThrewException', error => reject(error));\n\n          channel.emit('setCurrentStory', { storyId: toId(kind, story) });\n        });\n      }\n\n      // We need to emulate the event sent by the manager to the preview.\n      // In SB@4+ if we emit a message on the channel it will get picked up by the preview\n      // (note that we are on the preview side). However, in SB@3.4, perhaps more correctly,\n      // if we emit a message, it won't be picked up by the preview. So we need to reach\n      // in and simulate receiving an event\n      // eslint-disable-next-line no-underscore-dangle\n      channel._handleEvent({\n        type: 'setCurrentStory',\n        args: [{ kind, story }],\n        from: 'chromatic',\n      });\n\n      // If the story has rendered with an error, SB does not return any kind of error\n      // (we will fix this...) However, in the meantime, you can pick this up via a class on the body\n      if (document.body.classList.contains('sb-show-errordisplay')) {\n        const message = document.getElementById('error-message').textContent;\n        const stack = document.getElementById('error-stack').textContent;\n        const error = new Error(message);\n        error.stack = stack;\n        throw error;\n      }\n\n      return document.getElementById('root');\n    },\n    specs() {\n      const { __STORYBOOK_CLIENT_API__, __STORYBOOK_ADDONS_CHANNEL__ } = window;\n\n      if (!__STORYBOOK_CLIENT_API__ || !__STORYBOOK_ADDONS_CHANNEL__) {\n        throw new Error(\n          `Chromatic requires Storybook version at least 3.4. Please update your storybook!`\n        );\n      }\n\n      // eslint-disable-next-line no-underscore-dangle\n      const storyStore = __STORYBOOK_CLIENT_API__._storyStore;\n\n      return __STORYBOOK_CLIENT_API__\n        .getStorybook()\n        .map(({ kind, stories }) =>\n          stories.map(({ name }) => {\n            let parameters;\n            if (storyStore.getStoryAndParameters) {\n              // Annoying to have to do this, we should support this in .getStorybook\n              const {\n                parameters: { chromatic },\n              } = storyStore.getStoryAndParameters(kind, name);\n              if (chromatic) {\n                const { viewports, delay, disable, noScroll } = chromatic;\n                parameters = {\n                  ...(viewports && { viewports }),\n                  ...(delay && { delay }),\n                  ...(disable && { disable }),\n                  ...(noScroll && { noScroll }),\n                };\n              }\n            }\n\n            return {\n              name,\n              component: {\n                name: kind,\n                displayName: kind.split('/').slice(-1)[0],\n              },\n              runtime,\n              parameters,\n            };\n          })\n        )\n        .reduce((a, b) => [...a, ...b], []); // flatten\n    },\n    ...options,\n  });\n"],"file":"configure.js"}