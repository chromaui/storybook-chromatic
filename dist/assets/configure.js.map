{"version":3,"sources":["../../src/assets/configure.js"],"names":["location","pathname","match","jest","console","error","CHROMATIC_PARAMETERS","options","renderSpec","storyId","story","name","kind","component","window","__STORYBOOK_CLIENT_API__","__STORYBOOK_ADDONS_CHANNEL__","Error","channel","toId","Promise","resolve","reject","on","document","getElementById","emit","_handleEvent","type","args","from","body","classList","contains","message","textContent","stack","specs","storyStore","_storyStore","specFromStory","id","parameters","chromatic","param","value","displayName","split","slice","reduce","acc","key","extract","Object","values","map","getStorybook","stories","getStoryAndParameters","a","b"],"mappings":"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","sourcesContent":["/* eslint-env browser */\n/* eslint-disable import/no-extraneous-dependencies, global-require */\n\nimport { toId } from '@storybook/core/client';\n\nimport configure from '../client';\n\n// eslint-disable-next-line no-restricted-globals\nif (!location.pathname.match('/iframe.html') && typeof jest === 'undefined') {\n  // eslint-disable-next-line no-console\n  console.error(`storybook-chromatic should be installed in your \\`.storybook/config.js\\``);\n}\n\nconst CHROMATIC_PARAMETERS = [\n  'viewports',\n  'delay',\n  'disable',\n  'noScroll',\n  'diffThreshold',\n  'pauseAnimationAtEnd',\n];\n\nexport default (options = {}) =>\n  configure({\n    async renderSpec({ storyId, name: story, component: { name: kind } }) {\n      const { __STORYBOOK_CLIENT_API__, __STORYBOOK_ADDONS_CHANNEL__ } = window;\n\n      if (!__STORYBOOK_CLIENT_API__ || !__STORYBOOK_ADDONS_CHANNEL__) {\n        throw new Error(\n          `Chromatic requires Storybook version at least 3.4. Please update your Storybook!`\n        );\n      }\n\n      const channel = __STORYBOOK_ADDONS_CHANNEL__;\n\n      // In Storybook 5+ we can be sure of the emitting, and we need to use a storyId API\n      if (toId) {\n        return new Promise((resolve, reject) => {\n          channel.on('storyRendered', () => resolve(document.getElementById('root')));\n          channel.on('storyUnchanged', () => resolve(document.getElementById('root')));\n          channel.on('storyErrored', error => reject(error));\n          channel.on('storyThrewException', error => reject(error));\n          channel.on('storyMissing', () => reject(new Error('storyMissing')));\n\n          channel.emit('setCurrentStory', { storyId: storyId || toId(kind, story) });\n        });\n      }\n\n      // We need to emulate the event sent by the manager to the preview.\n      // In SB@4+ if we emit a message on the channel it will get picked up by the preview\n      // (note that we are on the preview side). However, in SB@3.4, perhaps more correctly,\n      // if we emit a message, it won't be picked up by the preview. So we need to reach\n      // in and simulate receiving an event\n      // eslint-disable-next-line no-underscore-dangle\n      channel._handleEvent({\n        type: 'setCurrentStory',\n        args: [{ kind, story }],\n        from: 'chromatic',\n      });\n\n      // If the story has rendered with an error, SB does not return any kind of error\n      // (we will fix this...) However, in the meantime, you can pick this up via a class on the body\n      if (document.body.classList.contains('sb-show-errordisplay')) {\n        const message = document.getElementById('error-message').textContent;\n        const stack = document.getElementById('error-stack').textContent;\n        const error = new Error(message);\n        error.stack = stack;\n        throw error;\n      }\n\n      return document.getElementById('root');\n    },\n    specs() {\n      const { __STORYBOOK_CLIENT_API__, __STORYBOOK_ADDONS_CHANNEL__ } = window;\n\n      if (!__STORYBOOK_CLIENT_API__ || !__STORYBOOK_ADDONS_CHANNEL__) {\n        throw new Error(\n          `Chromatic requires Storybook version at least 3.4. Please update your Storybook!`\n        );\n      }\n\n      // eslint-disable-next-line no-underscore-dangle\n      const storyStore = __STORYBOOK_CLIENT_API__._storyStore;\n\n      function specFromStory({ id, kind, name, parameters: { chromatic } = {} }) {\n        const param = value => (typeof value === 'function' ? value({ id, kind, name }) : value);\n        return {\n          storyId: id,\n          name,\n          component: {\n            name: kind,\n            displayName: kind.split(/\\||\\/|\\./).slice(-1)[0],\n          },\n          parameters:\n            chromatic &&\n            CHROMATIC_PARAMETERS.reduce(\n              (acc, key) => (chromatic[key] ? { ...acc, [key]: param(chromatic[key]) } : acc),\n              {}\n            ),\n        };\n      }\n\n      // Storybook 5+ API\n      if (storyStore.extract) {\n        return Object.values(storyStore.extract()).map(specFromStory);\n      }\n\n      // Storybook 4- API\n      return __STORYBOOK_CLIENT_API__\n        .getStorybook()\n        .map(({ kind, stories }) =>\n          stories.map(({ name }) =>\n            specFromStory({\n              kind,\n              name,\n              parameters:\n                storyStore.getStoryAndParameters &&\n                storyStore.getStoryAndParameters(kind, name).parameters,\n            })\n          )\n        )\n        .reduce((a, b) => [...a, ...b], []); // flatten\n    },\n    ...options,\n  });\n"],"file":"configure.js"}